##Qing Entries

#je_establish_national_language

je_end_han_discrimination = {
	icon = "gfx/interface/icons/event_icons/event_fire.dds"
	
	complete = {
			has_law = law_type:law_cultural_exclusion
		}
		
	on_complete = {
		remove_modifier = modifier_anti_manchu_sentiment
		add_loyalists = {
			value = 0.1
			culture = cu:han
			}
	}
	
	fail = {
		custom_tooltip = {
		text = taiping_happened_tt
		has_variable = cant_discriminate_han
		}		
	}
	
	on_fail = {
		remove_modifier = modifier_anti_manchu_sentiment
		#+1 to fragile unity
		}
		
	on_monthly_pulse = {
		random_events = {
			100 = 0
			3 = babylon_qing.2
		}
	}
}

je_qing_administrative_reform = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"

	complete = {
		AND = {
			institution_investment_level = {
				institution = institution_police
				value >= 3
			}
			has_law = law_type:law_dedicated_police
			bureaucracy >= 0 
			approaching_bureaucracy_shortage = no
			has_technology_researched = central_archives
		}
	}
	
	on_complete = {
	add_modifier = modifier_baojia_system
	}
}

je_end_female_infanticide = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	complete = {
		OR = {
			has_law = law_type:law_women_in_the_workplace
			has_law = law_type:law_womens_suffrage
		}
	}
	
	on_complete = {
	remove_modifier = modifier_female_shortage
	}
}

je_rural_poverty_qing = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	
	complete = {
		average_sol >= 10
		
		NOT = {
			has_law = law_type:law_serfdom
		}
		
		NOR = {
			has_law = law_type:law_consumption_based_taxation
			has_law = law_type:law_land_based_taxation
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}	
	}
	
	#line of code here that checks if at least 75% of substates have done it
	
	on_complete = {
		remove_modifier = modifier_rural_poverty
		
		add_loyalists = {
		value = 0.1
	#line of code here that affects fragile unity
		}
	}
	
	current_value = {
		value = var:rural_poverty_var
	}

	goal_add_value = {
		add = 3
	}

	progressbar = yes
}
		
je_investigate_military_reform = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	complete = {
	
			has_technology_researched = line_infantry	
		NOT = {
			has_law = law_type:law_peasant_levies
		}
	}		
	
	on_complete = {
		add_journal_entry = { type = je_reform_the_banner_system_local }
		add_journal_entry = { type = je_reform_the_banner_system_modern }
	}
}	
			
je_reform_the_banner_system_local = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	complete = {

			AND = {
		
			army_size >= 150
			has_technology_researched = napoleonic_warfare
		
				OR = {
					has_law = law_type:law_national_guard
					has_law = law_type:law_localized_garrisons
					has_law = law_type:law_faith_orders			
				}
			}
			scope:journal_entry = {
				is_goal_complete = yes
			}	
		}
		
	on_complete = {
	
		trigger_event = {
			id = event_babylon_qing.4
		}
		remove_modifier = modifier_crumbling_banner_system
		
		add_variable = chose_yong_ying
	}
	
	fail = {
		ig:ig_armed_forces = {
			is_powerful = yes
		}
	}
	
	on_fail = {
		#trigger_event = { id = event_babylon_qing.5 } #Tyranny of the Eight Banners
		remove_modifier = modifier_crumbling_banner_system
	}
	
	invalid = {
		NOT = {
			has_modifier = modifier_crumbling_banner_system
		}
	}
	
	current_value = {
		value = var:yong_ying_var
	}

	goal_add_value = {
		add = 4
	}

	progressbar = yes	
	
}

je_reform_the_banner_system_modern = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	complete = {
			AND = {
		
				army_size >= 150
				has_technology_researched = general_staff
				has_technology_researched = logistics
				has_technology_researched = rifling
				
				NOT = {
					any_scope_building = {
						is_building_type = building_barracks				
						OR = {
							building_has_goods_shortage = yes
							has_active_production_method = pm_no_organization
							# TO DO: Hook this whole part into Formation composition rather than old barracks PM 
						}
					}
				}
			}
		}
		
	on_complete = {
	
		trigger_event = {
			id = event_babylon_qing.4
		}
		remove_modifier = modifier_crumbling_banner_system
		add_variable = chose_new_army
	}
	
	fail = {
		ig:ig_armed_forces = {
			is_powerful = yes
		}
	}
	
	on_fail = {
		#trigger_event = { id = event_babylon_qing.5 } #Tyranny of the Eight Banners
		remove_modifier = modifier_crumbling_banner_system
	}
	
	invalid = {
		NOT = {
			has_modifier = modifier_crumbling_banner_system
		}
	}
}	
	
	
##Local Entries

	
je_establish_local_armies = { #Common
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	
	complete = {
		army_size >= 50
		has_technology_researched = napoleonic_warfare
		
		OR = {
		has_law = law_type:law_national_guard
		has_law = law_type:law_localized_garrisons
		has_law = law_type:law_faith_orders
		}
		
		NOT = {
			any_scope_building = {
				is_building_type = building_barracks				
				OR = {
					building_has_goods_shortage = yes
					has_active_production_method = pm_no_organization
					# TO DO: Hook this whole part into Formation composition rather than old barracks PM 
					# has_active_production_method = pm_no_artillery
					# has_active_production_method = pm_cannon_artillery
				}
			}
		}
	}
	
	on_complete = {
		
		if = {
			limit = {
				is_subject_of = c:CHI
			}
			c:CHI = {
				change_variable = {
					name = yong_ying_var
					add = 1
				}
			}
			add_modifier = {
				name = modifier_local_armies
			}
		}
		
		else = {
			remove_modifier = modifier_crumbling_banner_system
			c:CHI = {
				change_variable = {
					name = yong_ying_var
					add = 1
				}
			}
		}
	}
}

je_rural_poverty_substate = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	
	complete = {
		average_sol >= 10
		
		NOT = {
			has_law = law_type:law_serfdom
		}
		
		NOR = {
			has_law = law_type:law_consumption_based_taxation
			has_law = law_type:law_land_based_taxation
		}
	}
		
	on_complete = {
		remove_modifier = modifier_rural_poverty
		
		add_loyalists = {
		value = 0.1
		}
		
		if = {
			limit = {
				is_subject_of = c:CHI
			}
			c:CHI = {
				change_variable = {
					name = rural_poverty_var
					add = 1
				}
			}
		}
	}	
}

je_industrialize_china = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	
	complete = {
		OR = {
			any_scope_state = {
				is_incorporated = yes
				has_building = building_urban_center
				percent >= 0.75
				level >= 20
			}
			
			pop_type_percent_country = {
				pop_type = peasants
				percent < 0.35
			}			
		}
	}
	
	on_complete = {
		add_modifier = {
			name = modifier_great_leap_forward
			months = 240
			is_decaying = yes
		}
	}
}

je_promote_western_learning = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	
	complete = {
		has_technology_researched = dialectics
		
		any_scope_building = {
			is_building_type = building_university
			occupancy > 0.9
			level >= 5
		}
		
		NOT = {
			has_law = law_type:law_no_schools
		}
		
		institution_investment_level = {
			institution = institution_schools
			value >= 2
		}		
	}
	
	on_complete = {
		add_modifier = {
			name = modifier_self_strengthening_movement
			months = 240
			is_decaying = yes
		}
		remove_modifier = modifier_chinese_diglossia
	}
}
		
	
##Substate-Specific

je_pacify_highland_tribes = { #Sichuan
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	modifiers_while_active = {
		modifier_tusi_system
		}

	complete = {
		AND = {
			institution_investment_level = {
				institution = institution_police
				value >= 2
			}
			has_law = law_type:law_dedicated_police
		
			NOR = {
					has_law = law_type:law_traditionalism
					has_law = law_type:law_localized_garrisons
				}
			bureaucracy >= 0 
			approaching_bureaucracy_shortage = no
			}
		}


	on_complete = {
		add_modifier = {
			name = modifier_tusi_system
			months = long_modifier_time
			is_decaying = yes
			}
		trigger_event = {
			id = babylon_qing_substates.2
			}
		}

	on_monthly_pulse = {
		random_events = {
			100 = 0
			3 = babylon_qing_substates.3
			3 = babylon_qing_substates.4
			3 = babylon_qing_substates.5
		}
	}
	weight = 100
	should_be_pinned_by_default = yes
}

je_gateway_to_the_west = { #Liangguang
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	
	complete = {
		AND = {
			any_scope_building = {
                is_building_type = building_port
                level >= 10
				}
			has_law = law_type:law_free_trade
		
			NOR = {
					has_law = law_type:law_traditionalism
					has_law = law_type:law_agrarianism
				}
			}
		}
		
		on_complete = {
		add_modifier = {
			name = modifier_gateway_to_the_west
			}
		}
	should_be_pinned_by_default = yes
}

je_breadbasket_of_the_south = { #Huguang
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	
	modifiers_while_active = {
		modifier_breadbasket_of_the_south
	}
	
		complete = {
		pop_type_percent_country = {
			pop_type = peasants
			percent < 0.60
		}

		OR = {
			has_law = law_type:law_interventionism
			has_law = law_type:law_laissez_faire
		}
	}
	
		on_complete = {
			add_modifier = {
			name = modifier_breadbasket_of_the_south
			months = long_modifier_time
			}
			is_decaying = yes
			ig:ig_landowners = {
			remove_ideology = ideology_huguang_agrarian_idyll
			add_ideology = ideology_scholar_paternalistic
			}
		}
	should_be_pinned_by_default = yes
}

je_settle_the_steppe = { #Eastern Provinces
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	
	complete = {
		has_law = law_type:law_cultural_exclusion
		s:STATE_SHENGJING.region_state:MCH = {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 15
			}				
		}
		s:STATE_SOUTHERN_MANCHURIA.region_state:MCH = {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 15
			}				
		}
		s:STATE_NORTHERN_MANCHURIA.region_state:MCH = {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 15
			}				
		}
	}
	
	on_complete = {
	add_primary_culture = cu:han
	
		add_modifier = {
			name = modifier_qing_new_frontiers
			months = 240
			is_decaying = yes
		}
	}
	should_be_pinned_by_default = yes
}

je_pacify_and_settle_taiwan = { #Formosa
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	
	complete = {
		pop_type_percent_country = {
			pop_type = peasants
			percent < 0.35
		}
		s:STATE_FORMOSA.region_state:FRS = {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 10
			}				
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}		
	}
	
	on_complete = {	
		add_modifier = {
			name = modifier_qing_new_frontiers
			months = 240
			is_decaying = yes
		}
	}
	current_value = {
		value = root.gdp
	}

	goal_add_value = {
		value = root.gdp
		multiply = 2
	}
	progressbar = yes
	should_be_pinned_by_default = yes
}
