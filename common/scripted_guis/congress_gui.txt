set_proposal_type = {
	scope = country
	saved_scopes = {
		set_proposal_type
	}
	effect = {
		set_variable = {
			name = congress_proposal_type
			value = scope:set_proposal_type
		}
	}
}

has_proposal_type = {
	scope = country
	saved_scopes = {
		proposal_type
	}
	is_shown = {
		has_variable = congress_proposal_type
		var:congress_proposal_type = scope:proposal_type
	}
}

set_congress_stance = {
	scope = country
	saved_scopes = {
		congress_stance
	}
	effect = {
		if = {
			limit = {
				scope:congress_stance = 1
			}
			set_congress_stance_effect = {
				COUNTRY = root
				STANCE = 1
			}
		}
		if = {
			limit = {
				scope:congress_stance = 2
			}
			set_congress_stance_effect = {
				COUNTRY = root
				STANCE = 2
			}
		}
		if = {
			limit = {
				scope:congress_stance = 3
			}
			set_congress_stance_effect = {
				COUNTRY = root
				STANCE = 3
			}
		}
	}
}

has_congress_stance = {
	scope = country
	saved_scopes = {
		congress_stance
	}
	is_shown = {
		trigger_if = {
			limit = {
				scope:congress_stance = 1
			}
			is_target_in_global_variable_list = {
				name = current_congress_members_on_stance_1
				target = root
			}
		}
		trigger_if = {
			limit = {
				scope:congress_stance = 2
			}
			is_target_in_global_variable_list = {
				name = current_congress_members_on_stance_2
				target = root
			}
		}
		trigger_if = {
			limit = {
				scope:congress_stance = 3
			}
			is_target_in_global_variable_list = {
				name = current_congress_members_on_stance_3
				target = root
			}
		}
	}
}

is_congress_initiator = {
	is_shown = {
		THIS = global_var:babylon_vienna_congress_session_initiator
	}
}

end_congress = {
	effect = {
		global_var:babylon_vienna_congress_session_target = {
			save_scope_as = target_country
		}
		remove_global_variable = babylon_vienna_congress_in_session
		every_country = {
			if = {
				limit = {
					scope:target_country != this
				}
				aftermath_event_choice = yes
			}
			else {
				aftermath_event_consequence = yes
			}
		}
	}
}

set_strategic_region_target = {
	scope = country
	saved_scopes = {
		strategic_region
	}
	effect = {
		clear_variable_list ?= states_in_selected_strategic_region
		clear_variable_list ?= countries_in_selected_strategic_region
		if = {
			# Country scope
			limit = {
				OR = {
					var:congress_proposal_type = 1
					var:congress_proposal_type = 3
				}
			}
			scope:strategic_region = {
				every_scope_state = {
					limit = {
						NOT = {
							owner = root
						}
						NOT = {
							owner = {
								is_country_type = decentralized
							}
						}
					}
					owner = {
						root = {
							add_to_variable_list = {
								name = countries_in_selected_strategic_region
								target = prev
							}
						}
					}
				}
			}
		}
		if = {
			# State scope
			limit = {
				var:congress_proposal_type = 2
			}
			scope:strategic_region = {
				every_scope_state = {
					limit = {
						NOT = {
							owner = root
						}
					}
					root = {
						add_to_variable_list = {
							name = states_in_selected_strategic_region
							target = prev
						}
					}
				}
			}
		}
		if = {
			# Possible recognisable countries
			limit = {
				var:congress_proposal_type = 4
			}
			every_country = {
				limit = {
					NOT = {
						this = root
					}
					is_country_type = unrecognized
					any_scope_state = {
						region = scope:strategic_region
					}
				}
				root = {
					add_to_variable_list = {
						name = countries_in_selected_strategic_region
						target = prev
					}
				}
			}
		}
	}
}

has_strategic_region_target = {
	scope = country
	is_shown = {
		has_variable_list = states_in_selected_strategic_region
	}
}

clear_strategic_region_target = {
	scope = country
	effect = {
		clear_variable_list ?= states_in_selected_strategic_region
	}
}

is_great_power = {
	scope = country
	is_shown = {
		country_rank >= rank_value:great_power
	}
}

any_valid_state_in_strategic_region = {
	scope = country
	saved_scopes = {
		strategic_region
	}
	is_shown = {
		trigger_if = {
			# Hostile scope
			limit = {
				OR = {
					var:congress_proposal_type = 1
					var:congress_proposal_type = 2
					var:congress_proposal_type = 3
				}
			}
			scope:strategic_region = {
				any_scope_state = {
					count > 0
					NOT = {
						owner = root
					}
				}
			}
		}
		trigger_if = {
			# Unrecognised Country scope
			limit = {
				var:congress_proposal_type = 4
			}
			scope:strategic_region = {
				any_scope_state = {
					count > 0
					owner = {
						is_country_type = unrecognized
					}
				}
			}
		}
	}
}

set_congress_target_country = {
	scope = country
	saved_scopes = {
		target
	}
	effect = {
		set_variable = {
			name = set_congress_target_country
			value = scope:target
		}
	}
}

set_congress_target_state = {
	scope = country
	saved_scopes = {
		target_state
	}
	effect = {
		set_variable = {
			name = set_congress_target_state
			value = scope:target_state
		}
	}
}

start_congress = {
	scope = country
	effect = {
		congress_start_conference = {
			TYPE = var:congress_proposal_type
			INITIATOR = root
			TARGET = var:set_congress_target_country
			TARGET_STATE = var:set_congress_target_state
		}
		remove_variable = set_congress_target_country
		remove_variable = set_congress_target_state
	}
}
