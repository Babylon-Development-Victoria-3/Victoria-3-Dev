namespace = congress_random_event
congress_random_event.1 = {
	# Shoe throwing event
	type = country_event
	event_image = {
		video = "unspecific_politicians_arguing"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.1.t
	desc = congress_random_event.1.d
	flavor = congress_random_event.1.f
	placement = global_var:babylon_vienna_congress_session_initiator.capital
	duration = 1
	trigger = {
		# Should only throw a shoe if you're on the benches
		is_congress_observer = yes
		any_country = {
			is_congress_attendee = yes
			relations:root <= relations_threshold:poor
		}
	}
	immediate = {
		root = {
			save_scope_as = shoe_thrower
		}
		random_country = {
			limit = {
				# Should only throw shoes at attendees they have bad relations with
				is_congress_attendee = yes
				relations:root <= relations_threshold:poor
			}
			save_scope_as = shoe_target
		}
	}
	option = {
		# Throw the shoe
		name = congress_random_event.1.a
		random_list = {
			50 = {
				# Miss
				custom_tooltip = shoe_miss_tt
				change_relations = {
					country = scope:shoe_target
					value = -5
				}
				post_notification = shoe_miss_for_thrower
				scope:shoe_target = {
					post_notification = shoe_miss_for_target
				}
			}
			50 = {
				# Hit!
				custom_tooltip = shoe_hit_tt
				change_relations = {
					country = scope:shoe_target
					value = -10
				}
				scope:shoe_target = {
					trigger_event = {
						id = congress_random_event.2
						popup = yes
					}
					show_as_tooltip = {
						add_modifier = {
							name = babylon_vienna_congress_scaling_negative_prestige_modifier
							years = 1
							is_decaying = yes
							multiplier = 5
						}
					}
				}
				post_notification = shoe_hit_for_thrower
				if = {
					# If the target is actually on the floor everyone notices
					limit = {
						scope:shoe_target = {
							is_congress_observer = no
						}
					}
					custom_tooltip = {
						text = everyone_notices_your_hijinks_tt
						every_country = {
							limit = {
								is_congress_attendee = yes
								this != scope:shoe_target
								this != scope:shoe_thrower
							}
							trigger_event = {
								id = congress_random_event.3
							}
						}
					}
				}
				else = {
					# Else theres a 15% chance that people notices
					custom_tooltip = {
						text = observers_might_notice_your_hijinks_tt
						every_country = {
							limit = {
								is_congress_observer = yes
								this != scope:shoe_target
								this != scope:shoe_thrower
							}
							random = {
								chance = 15
								trigger_event = {
									id = congress_random_event.3
								}
							}
						}
					}
				}
			}
		}
		add_modifier = {
			name = babylon_vienna_congress_scaling_negative_prestige_modifier
			years = 1
			is_decaying = yes
			multiplier = 5
		}
		ai_chance = {
			base = 20
		}
	}
	option = {
		# Behave
		default_option = yes
		name = congress_random_event.1.b
		ai_chance = {
			base = 80
		}
	}
}

congress_random_event.2 = {
	# Shoe throwing event - direct hit!
	type = country_event
	event_image = {
		video = "unspecific_politicians_arguing"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.2.t
	desc = congress_random_event.2.d
	flavor = congress_random_event.2.f
	duration = 1
	trigger = {
		is_congress_attendee = yes
	}
	immediate = {
		add_modifier = {
			name = babylon_vienna_congress_scaling_negative_prestige_modifier
			years = 1
			is_decaying = yes
			multiplier = 5
		}
	}
	option = {
		# Someone just threw a shoe at us!
		name = congress_random_event.2.a
		show_as_tooltip = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_negative_prestige_modifier
				years = 1
				is_decaying = yes
				multiplier = 5
			}
		}
	}
}

congress_random_event.3 = {
	# Shoe throwing event - audience broadcast
	type = country_event
	event_image = {
		video = "unspecific_politicians_arguing"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.3.t
	desc = congress_random_event.3.d
	flavor = congress_random_event.3.f
	duration = 1
	trigger = {
		is_congress_attendee = yes
	}
	option = {
		# Someone just threw a shoe! Awesome!
		name = congress_random_event.3.a
		change_relations = {
			country = scope:shoe_target
			value = -10
		}
		change_relations = {
			country = scope:shoe_thrower
			value = 10
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		# Someone just threw a shoe!
		name = congress_random_event.3.b
		default_option = yes
		ai_chance = {
			base = 80
		}
	}
	option = {
		# Someone just threw a shoe! Awful
		name = congress_random_event.3.c
		change_relations = {
			country = scope:shoe_target
			value = 10
		}
		change_relations = {
			country = scope:shoe_thrower
			value = -10
		}
		ai_chance = {
			base = 10
		}
	}
}

congress_random_event.4 = {
	type = country_event
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.4.t
	desc = congress_random_event.4.desc
	flavor = congress_random_event.4.flavor
	placement = global_var:babylon_vienna_congress_session_initiator.capital
	duration = 1
	trigger = {
		is_congress_attendee = yes
		is_congress_observer = yes
	}
	immediate = {
		enable_random_congress_random_event_4_option = yes
		enable_random_congress_random_event_4_option = yes
		enable_random_congress_random_event_4_option = yes
		random_country = {
			limit = {
				is_congress_attendee = yes
				is_congress_observer = no
				this != root
			}
			save_scope_as = notable_attendee_scope
			root = {
				set_variable = {
					# For custom loc in descriptions...
					name = notable_attendee_scope_var
					value = prev
				}
			}
		}
		random_country = {
			limit = {
				is_congress_observer = yes
				this != root
				is_subject = no
			}
			save_scope_as = observer_1_scope
			root = {
				set_variable = {
					# For custom loc in descriptions...
					name = observer_1_scope_var
					value = prev
				}
			}
		}
		random_country = {
			limit = {
				is_congress_observer = yes
				this != root
				is_subject = no
				scope:observer_1_scope != this
			}
			save_scope_as = observer_2_scope
			root = {
				set_variable = {
					# For custom loc in descriptions...
					name = observer_2_scope_var
					value = prev
				}
			}
		}
	}
	option = {
		name = congress_random_event.4.a
		trigger = {
			has_variable = event_option_a_enabled
		}
		change_relations = {
			country = global_var:babylon_vienna_congress_session_initiator
			value = 10
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.b
		trigger = {
			has_variable = event_option_b_enabled
		}
		global_var:babylon_vienna_congress_session_initiator = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 5
				years = 1
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.c
		trigger = {
			has_variable = event_option_c_enabled
		}
		add_modifier = {
			name = babylon_vienna_congress_scaling_positive_prestige_modifier
			multiplier = 2
			years = 1
			is_decaying = yes
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.d
		trigger = {
			has_variable = event_option_d_enabled
		}
		random_country = {
			limit = {
				this != root
				is_congress_attendee = yes
				is_congress_observer = no
			}
			ruler = {
				add_modifier = {
					name = babylon_ruler_popularity
					multiplier = 5
					years = 1
					is_decaying = yes
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.e
		trigger = {
			has_variable = event_option_e_enabled
		}
		global_var:babylon_vienna_congress_session_initiator = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 5
				years = 1
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.f
		trigger = {
			has_variable = event_option_f_enabled
		}
		var:notable_attendee_scope_var = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 5
				years = 1
				is_decaying = yes
			}
			ruler = {
				add_modifier = {
					name = babylon_ruler_popularity
					multiplier = 5
					years = 1
					is_decaying = yes
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.g
		trigger = {
			has_variable = event_option_g_enabled
		}
		every_country = {
			limit = {
				is_congress_target = yes
			}
			if = {
				limit = {
					can_research = analytical_philosophy
				}
				add_technology_progress = {
					progress = 1000
					technology = analytical_philosophy
				}
			}
			else_if = {
				limit = {
					can_research = psychoanalysis
				}
				add_technology_progress = {
					progress = 825
					technology = psychoanalysis
				}
			}
			else_if = {
				limit = {
					can_research = philosophical_pragmatism
				}
				add_technology_progress = {
					progress = 650
					technology = philosophical_pragmatism
				}
			}
			else_if = {
				limit = {
					can_research = psychiatry
				}
				add_technology_progress = {
					progress = 500
					technology = psychiatry
				}
			}
			else_if = {
				limit = {
					can_research = empiricism
				}
				add_technology_progress = {
					progress = 375
					technology = empiricism
				}
			}
			else_if = {
				limit = {
					can_research = academia
				}
				add_technology_progress = {
					progress = 375
					technology = academia
				}
			}
			else_if = {
				limit = {
					can_research = rationalism
				}
				add_technology_progress = {
					progress = 375
					technology = rationalism
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.h
		trigger = {
			has_variable = event_option_h_enabled
		}
		scope:observer_1_scope = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 10
				years = 1
				is_decaying = yes
			}
		}
		scope:observer_2_scope = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 10
				years = 1
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.i
		trigger = {
			has_variable = event_option_i_enabled
		}
		if = {
			limit = {
				can_research = analytical_philosophy
			}
			add_technology_progress = {
				progress = 1000
				technology = analytical_philosophy
			}
		}
		else_if = {
			limit = {
				can_research = psychoanalysis
			}
			add_technology_progress = {
				progress = 825
				technology = psychoanalysis
			}
		}
		else_if = {
			limit = {
				can_research = philosophical_pragmatism
			}
			add_technology_progress = {
				progress = 650
				technology = philosophical_pragmatism
			}
		}
		else_if = {
			limit = {
				can_research = psychiatry
			}
			add_technology_progress = {
				progress = 500
				technology = psychiatry
			}
		}
		else_if = {
			limit = {
				can_research = empiricism
			}
			add_technology_progress = {
				progress = 375
				technology = empiricism
			}
		}
		else_if = {
			limit = {
				can_research = academia
			}
			add_technology_progress = {
				progress = 375
				technology = academia
			}
		}
		else_if = {
			limit = {
				can_research = rationalism
			}
			add_technology_progress = {
				progress = 375
				technology = rationalism
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.j
		trigger = {
			has_variable = event_option_j_enabled
		}
		global_var:babylon_vienna_congress_session_initiator = {
			add_modifier = {
				name = babylon_vienna_congress_scaling_positive_prestige_modifier
				multiplier = 5
				years = 1
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.k
		trigger = {
			has_variable = event_option_k_enabled
		}
		random_country = {
			limit = {
				is_congress_attendee = yes
				this != root
			}
			change_relations = {
				country = root
				value = 10
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = congress_random_event.4.l
		trigger = {
			has_variable = event_option_l_enabled
		}
		every_country = {
			limit = {
				capital.region = global_var:babylon_vienna_congress_session_target.capital.region
				this != root
				is_congress_target = no
			}
			root = {
				change_relations = {
					country = prev
					value = 5
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		clear_congress_random_event_4_option_variables = yes
	}
}

congress_random_event.5 = {
	# Setting up the whist table...
	type = country_event
	hidden = yes
	trigger = {
		is_congress_observer = yes
		is_in_game_of_whist = no
		any_country = {
			num >= 4
			is_congress_observer = yes
			is_in_game_of_whist = no
		}
	}
	immediate = {
		save_scope_as = player_1
		set_variable = {
			name = players_selected_playstyle
			value = 0
		}
		set_variable = {
			name = points_team_1
			value = 0
		}
		set_variable = {
			name = points_team_2
			value = 0
		}
		set_variable = whist_player
		random_country = {
			limit = {
				is_congress_observer = yes
				is_in_game_of_whist = no
				this != scope:player_1
			}
			save_scope_as = player_2
			set_variable = whist_player

		}
		random_country = {
			limit = {
				is_congress_observer = yes
				is_in_game_of_whist = no
				this != scope:player_1
				this != scope:player_2
			}
			save_scope_as = player_3
			set_variable = whist_player
		}
		random_country = {
			limit = {
				is_congress_observer = yes
				is_in_game_of_whist = no
				this != scope:player_1
				this != scope:player_2
				this != scope:player_3
			}
			save_scope_as = player_4
			set_variable = whist_player
		}
		scope:player_1 = {
			trigger_event = {
				id = congress_random_event.6
				popup = yes
			}
		}
		scope:player_2 = {
			trigger_event = {
				id = congress_random_event.6
				popup = yes
			}
		}
		scope:player_3 = {
			trigger_event = {
				id = congress_random_event.6
				popup = yes
			}
		}
		scope:player_4 = {
			trigger_event = {
				id = congress_random_event.6
				popup = yes
			}
		}
	}
}

congress_random_event.6 = {
	# Everyone decides their playstyle
	type = country_event
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.6.t
	desc = congress_random_event.6.desc
	flavor = congress_random_event.6.flavor
	placement = global_var:babylon_vienna_congress_session_initiator.capital
	duration = 1
	option = {
		# Play honorably
		# More bonus relations points from winning
		name = congress_random_event.6.a
		set_variable = plays_whist_honorably
		custom_tooltip = whist_honorable_tt
		default_option = yes
		ai_chance = {
			base = 45
		}
	}
	option = {
		# Play smart
		# Higher chance of winning points
		name = congress_random_event.6.b
		set_variable = plays_whist_smart
		custom_tooltip = whist_smart_tt
		ai_chance = {
			base = 45
		}
	}
	option = {
		# try to communicate
		# Even higher chance of winning; less points with your partner
		name = congress_random_event.6.c
		set_variable = plays_whist_communicating
		custom_tooltip = whist_communicating_tt
		ai_chance = {
			base = 10
		}
	}
	option = {
		# Cheat
		# Highest chance of winning, risk of getting caught costing you relations with everyone involved
		name = congress_random_event.6.d
		set_variable = plays_whist_cheating
		custom_tooltip = whist_cheating_tt
		random = {
			chance = 50
			custom_tooltip = whist_gets_caught_tt
			set_variable = caught_cheating_in_whist
		}
		ai_chance = {
			base = 0
		}
	}
	after = {
		scope:player_1 = {
			change_variable = {
				name = players_selected_playstyle
				add = 1
			}
			trigger_event = {
				id = congress_random_event.7
			}
		}
	}
}

congress_random_event.7 = {
	# Actual play round - hidden
	type = country_event
	hidden = yes
	trigger = {
		var:players_selected_playstyle >= 4
	}
	immediate = {
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		play_whist_round = yes
		scope:player_1 = {
			trigger_event = {
				id = congress_random_event.8
				popup = yes
				days = 7
			}
		}
		scope:player_2 = {
			trigger_event = {
				id = congress_random_event.8
				popup = yes
				days = 7
			}
		}
		scope:player_3 = {
			trigger_event = {
				id = congress_random_event.8
				popup = yes
				days = 7
			}
		}
		scope:player_4 = {
			trigger_event = {
				id = congress_random_event.8
				popup = yes
				days = 7
			}
		}
	}
}

congress_random_event.8 = {
	# Whist results
	type = country_event
	event_image = {
		video = "europenorthamerica_capitalists_meeting"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/law_icons/parliamentary_republic.dds"
	title = congress_random_event.8.t
	desc = {
		first_valid = {
			triggered_desc = {
				# We got caught cheating!
				desc = congress_random_event.8.d0
				trigger = {
					whist_we_got_caught_cheating = yes
				}
			}
			triggered_desc = {
				# Someone cheated!
				desc = congress_random_event.8.desc
				trigger = {
					whist_someone_got_caught_cheating = yes
				}
			}
			triggered_desc = {
				# grand slam: 13 points
				desc = congress_random_event.8.d2
				trigger = {
					whist_ended_in_grand_slam_for_us = yes
				}
			}
			triggered_desc = {
				# small slam: 13 points
				desc = congress_random_event.8.d3
				trigger = {
					whist_ended_in_small_slam_for_us = yes
				}
			}
			triggered_desc = {
				# won!
				desc = congress_random_event.8.d4
				trigger = {
					whist_ended_in_win_for_us = yes
				}
			}
			triggered_desc = {
				# lost!
				desc = congress_random_event.8.d5
				trigger = {
					whist_ended_in_loss_for_us = yes
				}
			}
		}
	}
	flavor = congress_random_event.8.flavor
	placement = global_var:babylon_vienna_congress_session_initiator.capital
	duration = 1
	immediate = {
		if = {
			limit = {
				OR = {
					scope:player_1 = {
						this != root
						has_variable = caught_cheating_in_whist
					}
					scope:player_2 = {
						this != root
						has_variable = caught_cheating_in_whist
					}
					scope:player_3 = {
						this != root
						has_variable = caught_cheating_in_whist
					}
					scope:player_4 = {
						this != root
						has_variable = caught_cheating_in_whist
					}
				}
			}
			random_country = {
				limit = {
					has_variable = caught_cheating_in_whist
					this != root
					OR = {
						scope:player_1 = this
						scope:player_2 = this
						scope:player_3 = this
						scope:player_4 = this
					}
				}
				save_scope_as = cheating_country_other
			}
		}
		if = {
			limit = {
				this = scope:player_1
			}
			scope:player_3 = {
				save_scope_as = whist_teammate
			}
			scope:player_2 = {
				save_scope_as = whist_opponent_1
			}
			scope:player_4 = {
				save_scope_as = whist_opponent_2
			}
		}
		else_if = {
			limit = {
				this = scope:player_2
			}
			scope:player_4 = {
				save_scope_as = whist_teammate
			}
			scope:player_1 = {
				save_scope_as = whist_opponent_1
			}
			scope:player_3 = {
				save_scope_as = whist_opponent_2
			}
		}
		else_if = {
			limit = {
				this = scope:player_3
			}
			scope:player_1 = {
				save_scope_as = whist_teammate
			}
			scope:player_2 = {
				save_scope_as = whist_opponent_1
			}
			scope:player_4 = {
				save_scope_as = whist_opponent_2
			}
		}
		else_if = {
			limit = {
				this = scope:player_4
			}
			scope:player_2 = {
				save_scope_as = whist_teammate
			}
			scope:player_1 = {
				save_scope_as = whist_opponent_1
			}
			scope:player_3 = {
				save_scope_as = whist_opponent_2
			}
		}
		set_variable = {
			name = team_1_points
			value = scope:player_1.var:points_team_1
		}
		set_variable = {
			name = team_2_points
			value = scope:player_1.var:points_team_2
		}
	}
	option = {
		# grand slam
		name = congress_random_event.8.a
		trigger = {
			whist_ended_in_grand_slam_for_us = yes
			whist_someone_got_caught_cheating = no
		}
		end_whist_game = yes
	}
	option = {
		# small slam
		name = congress_random_event.8.b
		trigger = {
			whist_ended_in_small_slam_for_us = yes
			whist_someone_got_caught_cheating = no
		}
		end_whist_game = yes
	}
	option = {
		# won
		name = congress_random_event.8.c
		trigger = {
			whist_ended_in_win_for_us = yes
			whist_someone_got_caught_cheating = no
		}
		end_whist_game = yes
	}
	option = {
		# loss
		name = congress_random_event.8.d
		trigger = {
			whist_ended_in_loss_for_us = yes
			whist_someone_got_caught_cheating = no
		}
		end_whist_game = yes
	}
	option = {
		# Someone cheated!
		name = congress_random_event.8.e
		trigger = {
			whist_someone_got_caught_cheating = yes
			whist_we_got_caught_cheating = no
		}
		end_whist_game_cheater = yes
	}
	option = {
		# You cheated and got caught
		name = congress_random_event.8.f
		trigger = {
			whist_we_got_caught_cheating = yes
		}
		end_whist_game_cheater = yes
	}
	after = {
		whist_variable_cleanup = yes
	}
}
